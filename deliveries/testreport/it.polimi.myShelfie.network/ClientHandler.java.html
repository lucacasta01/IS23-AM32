<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClientHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacoco.exec</a> &gt; <a href="index.source.html" class="el_package">it.polimi.myShelfie.network</a> &gt; <span class="el_source">ClientHandler.java</span></div><h1>ClientHandler.java</h1><pre class="source lang-java linenums">package it.polimi.myShelfie.network;
import com.google.gson.Gson;
import it.polimi.myShelfie.application.Server;
import it.polimi.myShelfie.network.RMI.RMIClient;
import it.polimi.myShelfie.utilities.*;
import it.polimi.myShelfie.utilities.pojo.Action;
import it.polimi.myShelfie.utilities.pojo.ChatMessage;
import it.polimi.myShelfie.utilities.pojo.Response;
import it.polimi.myShelfie.view.View;
import java.io.*;
import java.net.Socket;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

public class ClientHandler implements Runnable {
    private final Socket clientSocket;
<span class="fc" id="L21">    private String nickname=&quot;/&quot;;</span>
<span class="fc" id="L22">    private Boolean isRMI = false;</span>
    private BufferedReader in;
    private PrintWriter out;
    private final Server server;
<span class="fc" id="L26">    private boolean isPlaying = false;</span>
    private String color;
<span class="fc" id="L28">    private final List&lt;PingObject&gt; pongResponses = new ArrayList&lt;&gt;();</span>
    private final List&lt;Action&gt; rmiActions;
    private RMIClient rmiClient;
<span class="fc" id="L31">    public final Object locker = new Object();</span>




<span class="fc" id="L36">    public ClientHandler(Socket clientSocket) {</span>
<span class="fc" id="L37">        this.clientSocket = clientSocket;</span>
<span class="fc" id="L38">        this.server = Server.getInstance();</span>
<span class="fc" id="L39">        this.rmiClient = null;</span>
<span class="fc" id="L40">        this.rmiActions = null;</span>
<span class="fc" id="L41">    }</span>
<span class="fc" id="L42">    public ClientHandler() {</span>
<span class="fc" id="L43">        this.clientSocket = null;</span>
<span class="fc" id="L44">        this.server = Server.getInstance();</span>
<span class="fc" id="L45">        this.isRMI = true;</span>
<span class="fc" id="L46">        this.rmiActions = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L47">    }</span>

    public void shutdown() {
<span class="nc bnc" id="L50" title="All 2 branches missed.">        if(!isRMI) {</span>
            try {
<span class="nc" id="L52">                in.close();</span>
<span class="nc" id="L53">                out.close();</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">                if (!clientSocket.isClosed()) {</span>
<span class="nc" id="L55">                    clientSocket.close();</span>
                }
<span class="nc" id="L57">            } catch (Exception e) {</span>
<span class="nc" id="L58">                e.printStackTrace();</span>
<span class="nc" id="L59">            }</span>
        }else{
<span class="nc" id="L61">            synchronized (server.getConnectedClients()) {</span>
<span class="nc" id="L62">                server.getConnectedClients().get(this).setKill(true);</span>
<span class="nc" id="L63">            }</span>
        }
<span class="nc" id="L65">        server.removeClient(this);</span>
<span class="nc" id="L66">    }</span>

    public List&lt;Action&gt; getRmiActions() {
<span class="nc" id="L69">        return rmiActions;</span>
    }

    public void setRmiAction(Action rmiAction) {
<span class="nc" id="L73">        this.rmiActions.add(rmiAction);</span>
<span class="nc" id="L74">    }</span>

    public Action getAction(){
<span class="nc bnc" id="L77" title="All 2 branches missed.">        if(!isRMI) {</span>
            try {
<span class="nc" id="L79">                Action a = JsonParser.getAction(in.readLine());</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">                if (a == null) {</span>
<span class="nc" id="L81">                    return new Action(Action.ActionType.VOID, null, null, null, null, null);</span>
                }
<span class="nc" id="L83">                return a;</span>
<span class="nc" id="L84">            } catch (Exception e) {</span>
<span class="nc" id="L85">                return new Action(Action.ActionType.VOID, null, null, null, null, null);</span>
            }
        }else{
<span class="nc bnc" id="L88" title="All 2 branches missed.">            if(rmiActions.size()==0){</span>
<span class="nc" id="L89">                synchronized (rmiActions){</span>
                    try {
<span class="nc" id="L91">                        rmiActions.wait();</span>
<span class="nc" id="L92">                    }catch (Exception e){</span>
<span class="nc" id="L93">                        e.printStackTrace();</span>
<span class="nc" id="L94">                    }</span>
<span class="nc" id="L95">                }</span>
            }
<span class="nc" id="L97">            Action toReturn = rmiActions.get(0);</span>
<span class="nc" id="L98">            rmiActions.remove(0);</span>
<span class="nc" id="L99">            return toReturn;</span>
        }
    }



    public void run() {
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if(!isRMI){ //TCP</span>
            try {
<span class="nc" id="L108">                in = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));</span>
<span class="nc" id="L109">                out = new PrintWriter(clientSocket.getOutputStream(), true);</span>
<span class="nc" id="L110">                synchronized (locker){</span>
<span class="nc" id="L111">                    locker.notifyAll();</span>
<span class="nc" id="L112">                }</span>
<span class="nc" id="L113">            } catch (Exception e) {</span>
<span class="nc" id="L114">                System.err.println(&quot;Exception throws during stream creation: &quot;);</span>
<span class="nc" id="L115">                e.printStackTrace();</span>
<span class="nc" id="L116">            }</span>
        }
<span class="nc" id="L118">        gameLoop();</span>
<span class="nc" id="L119">    }</span>

    public void setNickname(String nickname) {
<span class="fc" id="L122">        this.nickname = nickname;</span>
<span class="fc" id="L123">    }</span>

    private void gameLoop(){
        try {
            Action action;
<span class="nc bnc" id="L128" title="All 2 branches missed.">            if(nickname.equals(&quot;/&quot;)){</span>
<span class="nc" id="L129">                sendInfoMessage(&quot;Please insert your username&quot;);</span>
<span class="nc" id="L130">                action = getAction();</span>
<span class="nc" id="L131">                String nickname = action.getInfo();</span>
<span class="nc bnc" id="L132" title="All 6 branches missed.">                while(action.getActionType() != Action.ActionType.INFO || server.isConnected(nickname) || !Utils.checkNicknameFormat(nickname)) {</span>
<span class="nc bnc" id="L133" title="All 2 branches missed.">                    if(action.getActionType() == Action.ActionType.INFO) {</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">                        if(!Utils.checkNicknameFormat(nickname)){</span>
<span class="nc" id="L135">                            notifyNicknameDeny(&quot;Invalid nickname&quot;);</span>
                        }
<span class="nc bnc" id="L137" title="All 2 branches missed.">                        else if(server.isConnected(nickname)){</span>
<span class="nc" id="L138">                            notifyNicknameDeny(&quot;Nickname already used&quot;);</span>
                        }

<span class="nc bnc" id="L141" title="All 2 branches missed.">                    }else if(action.getActionType()== Action.ActionType.CHAT){</span>
<span class="nc" id="L142">                        sendDeny(&quot;The chat is not active now&quot;);</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                    }else if(action.getActionType()== Action.ActionType.PICKTILES){</span>
<span class="nc" id="L144">                        sendDeny(&quot;Cannot pick tiles here, game not started&quot;);</span>
<span class="nc bnc" id="L145" title="All 2 branches missed.">                    }else if(action.getActionType()== Action.ActionType.SELECTCOLUMN){</span>
<span class="nc" id="L146">                        sendDeny(&quot;Cannot select column here, game not started&quot;);</span>
                    }
<span class="nc bnc" id="L148" title="All 2 branches missed.">                    else if(action.getActionType() == Action.ActionType.QUIT){</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">                        if(!isRMI) {</span>
<span class="nc" id="L150">                            server.getConnectedClients().get(this).setElapsed();</span>
<span class="nc" id="L151">                            sendShutdown();</span>
<span class="nc" id="L152">                            shutdown();</span>
                        }else{
<span class="nc" id="L154">                            server.getConnectedClients().get(this).setKill(true);</span>
<span class="nc" id="L155">                            server.getConnectedClients().remove(this);</span>
<span class="nc" id="L156">                            sendShutdown();</span>
<span class="nc" id="L157">                            shutdown();</span>
                        }
<span class="nc bnc" id="L159" title="All 2 branches missed.">                    }else if(action.getActionType() == Action.ActionType.PING){</span>
<span class="nc" id="L160">                        sendPong(action.getInfo());</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">                    } else if (action.getActionType() == Action.ActionType.PONG) {</span>
<span class="nc" id="L162">                        addPong();</span>
                    }
<span class="nc" id="L164">                    action = getAction();</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">                    if(action.getActionType() == Action.ActionType.INFO) {</span>
<span class="nc" id="L166">                        nickname = action.getInfo();</span>
                    }

                }
<span class="nc" id="L170">                synchronized (server.getUserGame()){</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">                    if(!server.getUserGame().containsKey(nickname)) {</span>
<span class="nc" id="L172">                        server.getUserGame().put(nickname, &quot;-&quot;);</span>
                    }
<span class="nc" id="L174">                }</span>
<span class="nc" id="L175">                this.nickname = nickname;</span>
<span class="nc" id="L176">                sendAccept(&quot;Username accepted&quot;);</span>
<span class="nc" id="L177">                notifyNicknameAccept();</span>
<span class="nc" id="L178">                System.out.println(nickname + &quot; connected to the server&quot;);</span>
            }

<span class="nc" id="L181">            boolean lobbyCreated = false;</span>
            String message;
            String chose;
<span class="nc" id="L184">            sendMenu();</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">            while((action=getAction())!=null){</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">                if(server.lobbyOf(this)==null){</span>
<span class="nc" id="L187">                    lobbyCreated=false;</span>
                }
<span class="nc bnc" id="L189" title="All 2 branches missed.">                if(!lobbyCreated){</span>
<span class="nc" id="L190">                    chose=action.getInfo();</span>
<span class="nc bnc" id="L191" title="All 14 branches missed.">                    while(action.getActionType() != Action.ActionType.INFO ||(action.getActionType()== Action.ActionType.INFO&amp;&amp;(!chose.equals(&quot;1&quot;) &amp;&amp; !chose.equals(&quot;2&quot;) &amp;&amp; !chose.equals(&quot;3&quot;) &amp;&amp; !chose.equals(&quot;4&quot;) &amp;&amp; !chose.equals(&quot;0&quot;)))){</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">                        if(action.getActionType() == Action.ActionType.INFO) {</span>
<span class="nc" id="L193">                            sendDeny(&quot;Type the right key&quot;);</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">                        }else if(action.getActionType()== Action.ActionType.CHAT){</span>
<span class="nc" id="L195">                            sendDeny(&quot;The chat is not active now&quot;);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">                        }else if(action.getActionType()== Action.ActionType.PICKTILES){</span>
<span class="nc" id="L197">                            sendDeny(&quot;Cannot pick tiles here, game not started&quot;);</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">                        }else if(action.getActionType()== Action.ActionType.SELECTCOLUMN){</span>
<span class="nc" id="L199">                            sendDeny(&quot;Cannot select column here, game not started&quot;);</span>
                        }
<span class="nc bnc" id="L201" title="All 2 branches missed.">                        else if(action.getActionType() == Action.ActionType.QUIT){</span>
<span class="nc bnc" id="L202" title="All 2 branches missed.">                            if(!isRMI) {</span>
<span class="nc" id="L203">                                server.getConnectedClients().get(this).setElapsed();</span>
<span class="nc" id="L204">                                sendShutdown();</span>
<span class="nc" id="L205">                                shutdown();</span>
                            }else{
<span class="nc" id="L207">                                sendShutdown();</span>
<span class="nc" id="L208">                                shutdown();</span>
                            }
<span class="nc" id="L210">                            System.out.println(nickname + &quot; disconnected&quot;);</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">                        }else if(action.getActionType() == Action.ActionType.PING){</span>
<span class="nc" id="L212">                            sendPong(action.getInfo());</span>
                        }
<span class="nc bnc" id="L214" title="All 2 branches missed.">                        else if (action.getActionType() == Action.ActionType.PONG) {</span>
<span class="nc" id="L215">                            addPong();</span>
                        }
<span class="nc" id="L217">                        action = getAction();</span>
<span class="nc bnc" id="L218" title="All 2 branches missed.">                        if(action !=null){</span>
<span class="nc" id="L219">                            chose = action.getInfo();</span>
                        }

                    }

                    //sendAccept(&quot;Game mode selected&quot;);
<span class="nc bnc" id="L225" title="All 6 branches missed.">                    switch (chose) {</span>
                        case &quot;1&quot; -&gt; {
<span class="nc" id="L227">                            sendInfoMessage(&quot;* CREATE NEW GAME *\n&quot;);</span>
<span class="nc" id="L228">                            String UID = Utils.UIDGenerator();</span>
<span class="nc" id="L229">                            Lobby lobby = new Lobby(this, UID, 0);</span>
<span class="nc" id="L230">                            System.out.println(&quot;New lobby created [&quot; + UID + &quot;]&quot;);</span>
<span class="nc" id="L231">                            server.getLobbyList().add(lobby);</span>
<span class="nc" id="L232">                            synchronized (server.getUserGame()) {</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">                                if(server.getUserGame().containsKey(this.nickname)){</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">                                    if(!server.getUserGame().get(this.nickname).equals(&quot;-&quot;)){</span>
<span class="nc" id="L235">                                        String oldUID = server.getUserGame().get(this.nickname);</span>
<span class="nc" id="L236">                                        server.getUserGame().entrySet().removeIf(entry -&gt; entry.getValue().equals(oldUID));</span>
<span class="nc" id="L237">                                        Path savingFilePath = Paths.get(System.getProperty(&quot;user.dir&quot;) + &quot;/config/savedgames/&quot;+ oldUID + &quot;.json&quot;);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">                                        if(savingFilePath.toFile().isFile()){</span>
                                            try {
<span class="nc" id="L240">                                                Files.delete(savingFilePath);</span>
<span class="nc" id="L241">                                                System.out.println(&quot;Old game file deleted successfully, UID: &quot;+ oldUID);</span>
                                            }
<span class="nc" id="L243">                                            catch (IOException e){</span>
<span class="nc" id="L244">                                                e.printStackTrace();</span>
<span class="nc" id="L245">                                            }</span>
                                        }
                                    }
                                }
<span class="nc" id="L249">                                server.getUserGame().put(nickname, lobby.getLobbyUID());</span>
<span class="nc" id="L250">                                server.saveUserGame();</span>
<span class="nc" id="L251">                            }</span>
<span class="nc" id="L252">                            lobbyCreated = true;</span>
<span class="nc" id="L253">                            this.isPlaying=true;</span>
<span class="nc" id="L254">                            server.runLobby(lobby);</span>
<span class="nc" id="L255">                        }</span>
                        case &quot;2&quot; -&gt; {
<span class="nc" id="L257">                            sendInfoMessage(&quot;* GAME LOADING *\n&quot;);</span>
                            Map&lt;String, String&gt; userGame;
<span class="nc" id="L259">                            synchronized (server.getUserGame()) {</span>
<span class="nc" id="L260">                                userGame = server.getUserGame();</span>
<span class="nc" id="L261">                            }</span>

<span class="nc bnc" id="L263" title="All 4 branches missed.">                            if (!userGame.containsKey(nickname) || userGame.get(nickname).equals(&quot;-&quot;)) {</span>
<span class="nc" id="L264">                                sendDeny(&quot;No game was found&quot;);</span>
<span class="nc" id="L265">                                denyLoadGame();</span>
<span class="nc" id="L266">                                sendMenu();</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">                            } else if(server.getLobbyList().stream().filter(lobby -&gt; lobby.getLobbyUID().equals(userGame.get(nickname))).toList().size()&gt;0){</span>
<span class="nc" id="L268">                                sendDeny(&quot;Another client started this game, retry to connect...&quot;);</span>
<span class="nc" id="L269">                                denyLoadGame();</span>
<span class="nc" id="L270">                                sendMenu();</span>
                            } else {
<span class="nc" id="L272">                                Lobby lobby = new Lobby(this, userGame.get(nickname));</span>
<span class="nc" id="L273">                                synchronized (server.getLobbyList()) {</span>
<span class="nc" id="L274">                                    sendInfoMessage(&quot;Joining game &quot; + userGame.get(nickname));</span>
<span class="nc" id="L275">                                    server.getLobbyList().add(lobby);</span>
<span class="nc" id="L276">                                }</span>
<span class="nc" id="L277">                                System.out.println(&quot;New lobby created [&quot; + lobby.getLobbyUID() + &quot;]&quot;);</span>
<span class="nc" id="L278">                                lobbyCreated = true;</span>
<span class="nc" id="L279">                                this.isPlaying=true;</span>
<span class="nc" id="L280">                                server.runLobby(lobby);</span>
                            }
<span class="nc" id="L282">                        }</span>
                        case &quot;3&quot; -&gt; {
<span class="nc" id="L284">                            sendInfoMessage(&quot;* GAME JOINING *\n&quot;);</span>
                            List&lt;Lobby&gt; lobbyList;
<span class="nc" id="L286">                            boolean flag = false;</span>
<span class="nc" id="L287">                            synchronized (server.getLobbyList()) {</span>
<span class="nc" id="L288">                                lobbyList = server.getLobbyList();</span>
<span class="nc" id="L289">                            }</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">                            for (Lobby l : lobbyList) {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">                                if (l.isOpen()) {</span>
<span class="nc" id="L292">                                    System.out.println(nickname + &quot; joined game &quot; + l.getLobbyUID());</span>
<span class="nc" id="L293">                                    synchronized (server.getUserGame()) {</span>
<span class="nc" id="L294">                                        server.getUserGame().put(nickname, l.getLobbyUID());</span>
<span class="nc" id="L295">                                        server.saveUserGame();</span>
<span class="nc" id="L296">                                    }</span>
<span class="nc" id="L297">                                    flag = true;</span>
<span class="nc" id="L298">                                    lobbyCreated = true;</span>
<span class="nc" id="L299">                                    this.isPlaying=false;</span>
<span class="nc" id="L300">                                    l.acceptPlayer(this);</span>
<span class="nc" id="L301">                                    break;</span>
                                }
<span class="nc" id="L303">                            }</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">                            if (!flag) {</span>
<span class="nc" id="L305">                                sendInfoMessage(&quot;No game available. You should create a new one&quot;);</span>
<span class="nc" id="L306">                                denyRandomGame();</span>
<span class="nc" id="L307">                                sendMenu();</span>
                            }
<span class="nc" id="L309">                        }</span>
                        case &quot;4&quot; -&gt; {
<span class="nc" id="L311">                            List&lt;Lobby&gt; filteredLobbyList = server.getLobbyList().stream()</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">                                    .filter(l -&gt; l.getGameMode() == Lobby.GameMode.SAVEDGAME)</span>
<span class="nc" id="L313">                                    .filter(l -&gt; l.getLobbyUID().equals(server.getUserGame().get(nickname)))</span>
<span class="nc" id="L314">                                    .toList();</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                            if (filteredLobbyList.size() &gt; 1) {</span>
<span class="nc" id="L316">                                throw new RuntimeException(&quot;UID not unique&quot;);</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">                            } else if (filteredLobbyList.size() == 1) {</span>
<span class="nc" id="L318">                                Lobby lobby = filteredLobbyList.get(0);</span>
<span class="nc" id="L319">                                sendInfoMessage(&quot;Game &quot; + lobby.getLobbyUID() + &quot; started by &quot; + lobby.getLobbyPlayers().get(0).nickname);</span>
<span class="nc" id="L320">                                sendInfoMessage(&quot;Would you like to join? [y/n]&quot;);</span>
<span class="nc" id="L321">                                oldGameFound();</span>
<span class="nc" id="L322">                                System.out.println(&quot;Saved game for &quot; + nickname + &quot; found&quot;);</span>

<span class="nc" id="L324">                                action = getAction();</span>

<span class="nc bnc" id="L326" title="All 8 branches missed.">                                while ((action.getActionType()!= Action.ActionType.INFO)||(action.getActionType()== Action.ActionType.INFO&amp;&amp;(!action.getInfo().equalsIgnoreCase(&quot;Y&quot;)&amp;&amp;!action.getInfo().equalsIgnoreCase(&quot;N&quot;)))){</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">                                    if(action.getActionType() == Action.ActionType.INFO) {</span>
<span class="nc" id="L328">                                        sendDeny(&quot;Type the right key...&quot;);</span>
<span class="nc bnc" id="L329" title="All 2 branches missed.">                                    }else if(action.getActionType()== Action.ActionType.CHAT){</span>
<span class="nc" id="L330">                                        sendDeny(&quot;The chat is not active now&quot;);</span>
<span class="nc bnc" id="L331" title="All 2 branches missed.">                                    }else if(action.getActionType()== Action.ActionType.PICKTILES){</span>
<span class="nc" id="L332">                                        sendDeny(&quot;Cannot pick tiles here, game not started&quot;);</span>
<span class="nc bnc" id="L333" title="All 2 branches missed.">                                    }else if(action.getActionType()== Action.ActionType.SELECTCOLUMN){</span>
<span class="nc" id="L334">                                        sendDeny(&quot;Cannot select column here, game not started&quot;);</span>
                                    }
<span class="nc bnc" id="L336" title="All 2 branches missed.">                                    else if(action.getActionType() == Action.ActionType.QUIT){</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">                                        if(!isRMI) {</span>
<span class="nc" id="L338">                                            server.getConnectedClients().get(this).setElapsed();</span>
<span class="nc" id="L339">                                            sendShutdown();</span>
<span class="nc" id="L340">                                            shutdown();</span>
                                        }else{
<span class="nc" id="L342">                                            sendShutdown();</span>
<span class="nc" id="L343">                                            shutdown();</span>
                                        }
<span class="nc bnc" id="L345" title="All 2 branches missed.">                                    }else if(action.getActionType() == Action.ActionType.PING){</span>
<span class="nc" id="L346">                                        sendPong(action.getInfo());</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">                                    } else if (action.getActionType() == Action.ActionType.PONG){</span>
<span class="nc" id="L348">                                        addPong();</span>
                                    }

<span class="nc" id="L351">                                    action = getAction();</span>
                                }
<span class="nc" id="L353">                                message = action.getInfo();</span>
<span class="nc bnc" id="L354" title="All 2 branches missed.">                                if (message.equalsIgnoreCase(&quot;Y&quot;)) {</span>
<span class="nc" id="L355">                                    lobby.broadcastMessage(nickname + &quot; joined&quot;);</span>
<span class="nc" id="L356">                                    System.out.println(nickname + &quot; joined game &quot; + lobby.getLobbyUID());</span>
<span class="nc" id="L357">                                    this.isPlaying=true;</span>
<span class="nc" id="L358">                                    filteredLobbyList.get(0).acceptPlayer(this);</span>
<span class="nc" id="L359">                                    lobbyCreated=true;</span>
                                } else {
<span class="nc" id="L361">                                    System.out.println(nickname + &quot; rejected invitation from &quot; + lobby.getLobbyUID());</span>
<span class="nc" id="L362">                                    lobby.broadcastMessage(nickname + &quot; has rejected the invitation.&quot;);</span>
<span class="nc" id="L363">                                    lobby.broadcastMessage(&quot;Game is closing...&quot;);</span>
<span class="nc" id="L364">                                    server.killLobby(lobby.getLobbyUID());</span>
                                    //System.out.println(&quot;Lobby &quot; + lobby.getLobbyUID() + &quot; killed.&quot;);
                                }
<span class="nc" id="L367">                            } else {</span>
<span class="nc" id="L368">                                sendInfoMessage(&quot;No lobby was found.&quot;);</span>
<span class="nc" id="L369">                                oldGameNotFound();</span>
<span class="nc" id="L370">                                sendMenu();</span>
                            }

<span class="nc" id="L373">                        }</span>
                        case &quot;0&quot; -&gt; {
<span class="nc bnc" id="L375" title="All 2 branches missed.">                            if(!isRMI) {</span>
<span class="nc" id="L376">                                server.getConnectedClients().get(this).setElapsed();</span>
                            }
<span class="nc" id="L378">                            System.out.println(nickname + &quot; disconnected&quot;);</span>
<span class="nc" id="L379">                            sendShutdown();</span>
<span class="nc" id="L380">                            shutdown();</span>
                        }
<span class="nc" id="L382">                    }</span>


                }else{
<span class="nc" id="L386">                    Lobby l = server.lobbyOf(this);</span>

<span class="nc bnc" id="L388" title="All 2 branches missed.">                    if(l!=null){</span>
<span class="nc" id="L389">                        synchronized (l.actions){</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">                            if(action.getActionType()== Action.ActionType.PING){</span>
<span class="nc" id="L391">                                sendPong(action.getInfo());</span>
                            }
<span class="nc bnc" id="L393" title="All 2 branches missed.">                            else if (action.getActionType() == Action.ActionType.PONG) {</span>
<span class="nc" id="L394">                                addPong();</span>
                            }
<span class="nc bnc" id="L396" title="All 2 branches missed.">                            else if(action.getActionType() == Action.ActionType.QUIT){</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">                                if(!isRMI){</span>
<span class="nc" id="L398">                                    server.getConnectedClients().get(this).setElapsed();</span>
<span class="nc" id="L399">                                    server.getConnectedClients().remove(this);</span>
<span class="nc" id="L400">                                    System.out.println(ANSI.RED+nickname+&quot; left the game&quot;+ANSI.RESET_COLOR);</span>
                                }else{
<span class="nc" id="L402">                                    server.getConnectedClients().get(this).setKill(true);</span>
<span class="nc" id="L403">                                    server.getConnectedClients().remove(this);</span>
<span class="nc" id="L404">                                    l.getLobbyPlayers().remove(this);</span>
<span class="nc" id="L405">                                    System.out.println(ANSI.RED+nickname+&quot; left the game&quot;+ANSI.RESET_COLOR);</span>
                                }
<span class="nc" id="L407">                                l.notifyExit();</span>
<span class="nc" id="L408">                                server.killLobby(l.getLobbyUID());</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">                            }else if(action.getActionType()== Action.ActionType.REQUEST_MENU){</span>
<span class="nc" id="L410">                                l.recieveAction(action);</span>
<span class="nc" id="L411">                                l.actions.notifyAll();</span>
<span class="nc" id="L412">                                isPlaying=false;</span>
<span class="nc" id="L413">                                l.setEndWaitingPlayers();</span>
<span class="nc" id="L414">                                lobbyCreated=false;</span>
<span class="nc" id="L415">                                synchronized (server.getLobbyList()) {</span>
<span class="nc" id="L416">                                    server.getLobbyList().remove(server.lobbyOf(this));</span>
<span class="nc" id="L417">                                }</span>
                            }else{
<span class="nc" id="L419">                                l.recieveAction(action);</span>
<span class="nc" id="L420">                                l.actions.notifyAll();</span>
                            }
<span class="nc" id="L422">                        }</span>
                    }
<span class="nc" id="L424">                }</span>

            }
<span class="nc" id="L427">        } catch (Exception e) {</span>
<span class="nc" id="L428">            e.printStackTrace();</span>
<span class="nc" id="L429">        }</span>
<span class="nc" id="L430">    }</span>

    private void denyRandomGame() {
<span class="nc bnc" id="L433" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L435">                rmiClient.denyRandomGame();</span>
            }
<span class="nc" id="L437">            catch (Exception e){</span>
<span class="nc" id="L438">                e.printStackTrace();</span>
<span class="nc" id="L439">            }</span>
        }
        else {
<span class="nc" id="L442">            Response r = new Response(Response.ResponseType.RANDOM_GAME_NOT_FOUND, null, null, null);</span>
<span class="nc" id="L443">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L445">                out.println(gson.toJson(r));</span>
<span class="nc" id="L446">            } catch (Exception e) {</span>
<span class="nc" id="L447">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L448">                e.printStackTrace();</span>
<span class="nc" id="L449">            }</span>
        }
<span class="nc" id="L451">    }</span>

    private void oldGameNotFound() {
<span class="nc bnc" id="L454" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L456">                rmiClient.oldGameNotFound();</span>
            }
<span class="nc" id="L458">            catch (Exception e){</span>
<span class="nc" id="L459">                e.printStackTrace();</span>
<span class="nc" id="L460">            }</span>
        }
        else {
<span class="nc" id="L463">            Response r = new Response(Response.ResponseType.OLD_GAME_NOT_FOUND, null, null, null);</span>
<span class="nc" id="L464">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L466">                out.println(gson.toJson(r));</span>
<span class="nc" id="L467">            } catch (Exception e) {</span>
<span class="nc" id="L468">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L469">                e.printStackTrace();</span>
<span class="nc" id="L470">            }</span>
        }
<span class="nc" id="L472">    }</span>

    private synchronized void oldGameFound() {
<span class="nc bnc" id="L475" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L477">                rmiClient.foundOldGame();</span>
            }
<span class="nc" id="L479">            catch (Exception e){</span>
<span class="nc" id="L480">                e.printStackTrace();</span>
<span class="nc" id="L481">            }</span>
        }
        else {
<span class="nc" id="L484">            Response r = new Response(Response.ResponseType.FOUND_OLD_GAME, null, null, null);</span>
<span class="nc" id="L485">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L487">                out.println(gson.toJson(r));</span>
<span class="nc" id="L488">            } catch (Exception e) {</span>
<span class="nc" id="L489">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L490">                e.printStackTrace();</span>
<span class="nc" id="L491">            }</span>
        }
<span class="nc" id="L493">    }</span>

    public synchronized void denyLoadGame() {
<span class="nc bnc" id="L496" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L498">                rmiClient.denyLoadGame();</span>
            }
<span class="nc" id="L500">            catch (Exception e){</span>
<span class="nc" id="L501">                e.printStackTrace();</span>
<span class="nc" id="L502">            }</span>
        }
        else {
<span class="nc" id="L505">            Response r = new Response(Response.ResponseType.DENY_LOAD_GAME, null, null, null);</span>
<span class="nc" id="L506">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L508">                out.println(gson.toJson(r));</span>
<span class="nc" id="L509">            } catch (Exception e) {</span>
<span class="nc" id="L510">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L511">                e.printStackTrace();</span>
<span class="nc" id="L512">            }</span>
        }
<span class="nc" id="L514">    }</span>

    public String getNickname() {
<span class="fc" id="L517">        return nickname;</span>
    }

    public String getColor() {
<span class="fc" id="L521">        return color;</span>
    }
    public boolean isRMI(){
<span class="nc" id="L524">        return this.isRMI;</span>
    }

    public void setColor(String color) {
<span class="fc" id="L528">        this.color = color;</span>
<span class="fc" id="L529">    }</span>
    public synchronized boolean isPlaying() {
<span class="nc" id="L531">        return isPlaying;</span>
    }

    public synchronized void setPlaying(boolean playing) {
<span class="nc" id="L535">        isPlaying = playing;</span>
<span class="nc" id="L536">    }</span>
    public synchronized void sendInfoMessage(String message) {
<span class="nc bnc" id="L538" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L540">                rmiClient.infoMessage(message);</span>
            }
<span class="nc" id="L542">            catch (Exception e){</span>
<span class="nc" id="L543">                e.printStackTrace();</span>
<span class="nc" id="L544">            }</span>
        }
        else {
<span class="nc" id="L547">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L549">                out.println(gson.toJson(new Response(Response.ResponseType.INFO, null, null, message)));</span>
<span class="nc" id="L550">            } catch (Exception e) {</span>
<span class="nc" id="L551">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L552">                e.printStackTrace();</span>
<span class="nc" id="L553">            }</span>
        }
<span class="nc" id="L555">    }</span>

    public synchronized void sendChatMessage(ChatMessage chatMessage){
<span class="nc bnc" id="L558" title="All 2 branches missed.">        if(isRMI){</span>
            try{
                //todo handling auto-send rmi
<span class="nc" id="L561">                rmiClient.chatMessage(chatMessage);</span>
            }
<span class="nc" id="L563">            catch (Exception e){</span>
<span class="nc" id="L564">                e.printStackTrace();</span>
<span class="nc" id="L565">            }</span>
        }
        else {
<span class="nc" id="L568">            Response r = new Response(Response.ResponseType.CHATMESSAGE, chatMessage, null, null);</span>
<span class="nc" id="L569">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L571">                out.println(gson.toJson(r));</span>
<span class="nc" id="L572">            } catch (Exception e) {</span>
<span class="nc" id="L573">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L574">                e.printStackTrace();</span>
<span class="nc" id="L575">            }</span>
        }
<span class="nc" id="L577">    }</span>
    
    public synchronized void notifyNicknameAccept(){
<span class="nc bnc" id="L580" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L582">                rmiClient.nicknameAccepted();</span>
            }
<span class="nc" id="L584">            catch (Exception e){</span>
<span class="nc" id="L585">                e.printStackTrace();</span>
<span class="nc" id="L586">            }</span>
        }
        else {
<span class="nc" id="L589">            Response r = new Response(Response.ResponseType.NICKNAME_ACCEPTED, new ChatMessage(nickname, &quot;&quot;,&quot;&quot;), null, null);</span>
<span class="nc" id="L590">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L592">                out.println(gson.toJson(r));</span>
<span class="nc" id="L593">            } catch (Exception e) {</span>
<span class="nc" id="L594">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L595">                e.printStackTrace();</span>
<span class="nc" id="L596">            }</span>
        }
<span class="nc" id="L598">    }</span>

    public synchronized void notifyNicknameDeny(String message){
<span class="nc bnc" id="L601" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L603">                rmiClient.nicknameDenied(message);</span>
            }
<span class="nc" id="L605">            catch (Exception e){</span>
<span class="nc" id="L606">                e.printStackTrace();</span>
<span class="nc" id="L607">            }</span>
        }
        else {
<span class="nc" id="L610">            sendDeny(message);</span>
<span class="nc" id="L611">            Response r = new Response(Response.ResponseType.NICKNAME_DENIED, new ChatMessage(nickname, &quot;&quot;,&quot;&quot;), null, message);</span>
<span class="nc" id="L612">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L614">                out.println(gson.toJson(r));</span>
<span class="nc" id="L615">            } catch (Exception e) {</span>
<span class="nc" id="L616">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L617">                e.printStackTrace();</span>
<span class="nc" id="L618">            }</span>
        }
<span class="nc" id="L620">    }</span>

    public synchronized void notifyLobbyCreated(int playersNumber) {
<span class="nc bnc" id="L623" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L625">                rmiClient.notifyLobbyCreated(Integer.toString(playersNumber));</span>
            }
<span class="nc" id="L627">            catch (Exception e){</span>
<span class="nc" id="L628">                e.printStackTrace();</span>
<span class="nc" id="L629">            }</span>
        }
        else {
<span class="nc" id="L632">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L634">                out.println(gson.toJson(new Response(Response.ResponseType.LOBBY_CREATED, null, null, Integer.toString(playersNumber))));</span>
<span class="nc" id="L635">            } catch (Exception e) {</span>
<span class="nc" id="L636">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L637">                e.printStackTrace();</span>
<span class="nc" id="L638">            }</span>
        }
<span class="nc" id="L640">    }</span>
    public synchronized void notifyLobbyJoined(String waitPlayerStatus){
<span class="nc bnc" id="L642" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L644">                rmiClient.notifyGameJoined();</span>
            }
<span class="nc" id="L646">            catch (Exception e){</span>
<span class="nc" id="L647">                e.printStackTrace();</span>
<span class="nc" id="L648">            }</span>
        }
        else {
<span class="nc" id="L651">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L653">                out.println(gson.toJson(new Response(Response.ResponseType.LOBBY_JOINED, null, null, waitPlayerStatus)));</span>
<span class="nc" id="L654">            } catch (Exception e) {</span>
<span class="nc" id="L655">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L656">                e.printStackTrace();</span>
<span class="nc" id="L657">            }</span>
        }
<span class="nc" id="L659">    }</span>

    public synchronized void notifyGameStarted() {
<span class="nc bnc" id="L662" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L664">                rmiClient.notifyGameStarted();</span>
            }
<span class="nc" id="L666">            catch (Exception e){</span>
<span class="nc" id="L667">                e.printStackTrace();</span>
<span class="nc" id="L668">            }</span>
        }
        else {
<span class="nc" id="L671">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L673">                out.println(gson.toJson(new Response(Response.ResponseType.GAME_STARTED, null, null, null)));</span>
<span class="nc" id="L674">            } catch (Exception e) {</span>
<span class="nc" id="L675">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L676">                e.printStackTrace();</span>
<span class="nc" id="L677">            }</span>
        }
<span class="nc" id="L679">    }</span>

    public synchronized void sendDeny(String message) {
<span class="nc bnc" id="L682" title="All 2 branches missed.">        if(isRMI){</span>
            try {
<span class="nc" id="L684">                rmiClient.denied(message);</span>
            }
<span class="nc" id="L686">            catch (Exception e){</span>
<span class="nc" id="L687">                e.printStackTrace();</span>
<span class="nc" id="L688">            }</span>
        }
        else {
<span class="nc" id="L691">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L693">                out.println(gson.toJson(new Response(Response.ResponseType.DENIED, null, null, message)));</span>
<span class="nc" id="L694">            } catch (Exception e) {</span>
<span class="nc" id="L695">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L696">                e.printStackTrace();</span>
<span class="nc" id="L697">            }</span>
        }
<span class="nc" id="L699">    }</span>

    public void addPong(){
<span class="nc" id="L702">        synchronized (pongResponses){</span>
<span class="nc" id="L703">            pongResponses.add(new PingObject(false));</span>
<span class="nc" id="L704">            pongResponses.notifyAll();</span>
<span class="nc" id="L705">        }</span>
<span class="nc" id="L706">    }</span>

    public synchronized  void sendPong(String count){
<span class="nc" id="L709">        Gson gson = new Gson();</span>
        try {
<span class="nc" id="L711">            out.println(gson.toJson(new Response(Response.ResponseType.PONG, null ,null,count)));</span>
<span class="nc" id="L712">        } catch (Exception e) {</span>
<span class="nc" id="L713">            System.out.println(&quot;Error occurred while sending a pong: &quot;);</span>
<span class="nc" id="L714">            e.printStackTrace();</span>
<span class="nc" id="L715">        }</span>
<span class="nc" id="L716">    }</span>

    public synchronized void sendAccept(String message) {
<span class="nc bnc" id="L719" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L721">                rmiClient.valid(message);</span>
            }
<span class="nc" id="L723">            catch (Exception e){</span>
<span class="nc" id="L724">                e.printStackTrace();</span>
<span class="nc" id="L725">            }</span>
        }
        else {
<span class="nc" id="L728">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L730">                out.println(gson.toJson(new Response(Response.ResponseType.VALID, new ChatMessage(this.nickname, &quot;&quot;,&quot;&quot;), null, message)));</span>
<span class="nc" id="L731">            } catch (Exception e) {</span>
<span class="nc" id="L732">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L733">                e.printStackTrace();</span>
<span class="nc" id="L734">            }</span>
        }
<span class="nc" id="L736">    }</span>

    public synchronized void notifyNewJoin(String waitStatus) {
<span class="nc bnc" id="L739" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L741">                rmiClient.notifyNewJoin();</span>
            }
<span class="nc" id="L743">            catch (Exception e){</span>
<span class="nc" id="L744">                e.printStackTrace();</span>
<span class="nc" id="L745">            }</span>
        }
        else {
<span class="nc" id="L748">            Gson gson = new Gson();</span>
            try {
<span class="nc" id="L750">                out.println(gson.toJson(new Response(Response.ResponseType.SOMEONE_JOINED_LOBBY, null, null, waitStatus)));</span>
<span class="nc" id="L751">            } catch (Exception e) {</span>
<span class="nc" id="L752">                System.out.println(&quot;Error occurred while sending a message: &quot;);</span>
<span class="nc" id="L753">                e.printStackTrace();</span>
<span class="nc" id="L754">            }</span>
        }
<span class="nc" id="L756">    }</span>

    public synchronized void sendPing() throws IOException{
<span class="nc" id="L759">        Gson gson = new Gson();</span>
<span class="nc" id="L760">        out.println(gson.toJson(new Response(Response.ResponseType.PING, null,null, &quot;ping&quot;)));</span>
<span class="nc" id="L761">    }</span>

    public List&lt;PingObject&gt; getPongResponses() {
<span class="nc" id="L764">        return pongResponses;</span>
    }



    public synchronized void sendShutdown(){
<span class="nc bnc" id="L770" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L772">                rmiClient.remoteShutdown(&quot;Closing...&quot;);</span>
            }
<span class="nc" id="L774">            catch (Exception e){</span>
<span class="nc" id="L775">                e.printStackTrace();</span>
<span class="nc" id="L776">            }</span>
        }
        else {
<span class="nc" id="L779">            Gson gson = new Gson();</span>
<span class="nc" id="L780">            out.println(gson.toJson(new Response(Response.ResponseType.SHUTDOWN, null, null, &quot;Closing...&quot;)));</span>
        }
<span class="nc" id="L782">    }</span>

    public synchronized void sendView(View view) {
<span class="nc bnc" id="L785" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L787">                rmiClient.update(view);</span>
            }
<span class="nc" id="L789">            catch (Exception e){</span>
<span class="nc" id="L790">                e.printStackTrace();</span>
<span class="nc" id="L791">            }</span>
        }
        else {
<span class="nc" id="L794">            Gson gson = new Gson();</span>
<span class="nc" id="L795">            out.println(gson.toJson(new Response(Response.ResponseType.UPDATE, null, view, null)));</span>
        }
<span class="nc" id="L797">    }</span>

    public RMIClient getRmiClient() {
<span class="nc" id="L800">        return rmiClient;</span>
    }

    public synchronized void sendHelpMessage(){

<span class="nc" id="L805">        String string = &quot;\t\t\t\t\t\t&quot; + ANSI.BOLD + ANSI.ITALIC + &quot;****** MY SHELFIE ******&quot; + ANSI.RESET_STYLE + &quot;\n\n&quot; +</span>
                ANSI.BOLD + &quot;Command\t\t\tArguments\t\t\t\tNotes&quot; + ANSI.RESET_STYLE + &quot;\n&quot; +
                &quot;/chat\t\t\ttext message\t\t\tuse it to send a chat message to other players\n&quot; +
                &quot;/collect\t\tr1,c1 (r2,c2) (r3,c3)\t\tgame command to collect tiles from the board\n&quot; +
                &quot;/order\t\t\tC1 C2 C3\t\t\t\tuse it if you want change the tiles order before insert them in your shelf\n&quot; +
                &quot;/column\t\t\tcol number\t\t\t\tgame command to insert the tiles you have collected into your shelf at the selected column\n&quot; +
                &quot;/quit\t\t\t-\t\t\t\t\t\texit from the game\n&quot;;
<span class="nc" id="L812">        sendInfoMessage(string);</span>
<span class="nc" id="L813">    }</span>
    public void sendMenu(){
<span class="nc bnc" id="L815" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L817">                rmiClient.returnToMenu();</span>
            }
<span class="nc" id="L819">            catch (Exception e){</span>
<span class="nc" id="L820">                e.printStackTrace();</span>
<span class="nc" id="L821">            }</span>
        }
        else {
<span class="nc" id="L824">            Gson gson = new Gson();</span>
<span class="nc" id="L825">            out.println(gson.toJson(new Response(Response.ResponseType.RETURN_TO_MENU, null, null, null)));</span>
        }
<span class="nc" id="L827">    }</span>

    public synchronized void setRmiClient(RMIClient client){
<span class="nc" id="L830">        this.rmiClient = client;</span>
<span class="nc" id="L831">    }</span>


    public void acceptLoadGame() {
<span class="nc bnc" id="L835" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L837">                rmiClient.acceptLoadGame();</span>
            }
<span class="nc" id="L839">            catch (Exception e){</span>
<span class="nc" id="L840">                e.printStackTrace();</span>
<span class="nc" id="L841">            }</span>
        }
        else {
<span class="nc" id="L844">            Gson gson = new Gson();</span>
<span class="nc" id="L845">            out.println(gson.toJson(new Response(Response.ResponseType.ACCEPT_LOAD_GAME, null, null, null)));</span>
        }
<span class="nc" id="L847">    }</span>

    public void notifyCollectAccepted() {
<span class="nc bnc" id="L850" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L852">                rmiClient.acceptCollect();</span>
            }
<span class="nc" id="L854">            catch (Exception e){</span>
<span class="nc" id="L855">                e.printStackTrace();</span>
<span class="nc" id="L856">            }</span>
        }
        else {
<span class="nc" id="L859">            Gson gson = new Gson();</span>
<span class="nc" id="L860">            out.println(gson.toJson(new Response(Response.ResponseType.ACCEPT_COLLECT, null, null, null)));</span>
        }
<span class="nc" id="L862">    }</span>

    public void notifyGameEnded(String rank) {
<span class="nc bnc" id="L865" title="All 2 branches missed.">        if(isRMI){</span>
            try{
<span class="nc" id="L867">                rmiClient.notifyGameEnded(rank);</span>
            }
<span class="nc" id="L869">            catch (Exception e){</span>
<span class="nc" id="L870">                e.printStackTrace();</span>
<span class="nc" id="L871">            }</span>
        }
        else {
<span class="nc" id="L874">            Gson gson = new Gson();</span>
<span class="nc" id="L875">            out.println(gson.toJson(new Response(Response.ResponseType.GAME_ENDED, null, null, rank)));</span>
        }
<span class="nc" id="L877">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>